{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block css_styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Image and Card Section -->
<div class="top-container text-center">
    <div>
        <h1>Welcome to Dreamers Market!</h1>
        <p>Your premier destination for prized second-hand treasures</p>
        <!-- Icon centered below the text -->
        <div class="d-flex justify-content-center mt-3">
            <i class="bi bi-cart-check large-icon"></i> <!-- Adjust the icon size and type as needed -->
        </div>
    </div>
    <a id="btnPostCard" href="{{ url_for('item.item_new') }}" class="btn btn-success">
        Post an Ad
    </a>
</div>
<div class="container">
    <div class="row">
        {% for item in items %}
            <div class="col-sm-6 col-lg-3">
                <div class="card product-card">
                    <img src="{{ item.thumb_photo_url if item.thumb_photo_url else '/static/img/not-found.webp' }}" onerror="this.src='/static/img/not-found.webp'" class="card-img-top" alt="{{ item.title }} thumb photo">
                    <div class="card-body">
                        <h5 class="card-title card-rand-item-text">{{ item.title }}</h5>
                        <div id="notificationMessages1" class="card-text card-rand-item-text">
                            <p>{{ item.description }}</p>
                        </div>
                        <a href="{{ url_for('item.item', item_id=item.id) }}" class="btn btn-primary">Shop Now</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Back to top button -->
<a href="#" class="back-to-top">
    <img src="{{ url_for('static', filename='img/back to top.jpg') }}" alt="back to top">
</a>

<!-- Links section -->
<!-- <div class="card border-secondary">
    <div class="card-body list-group"> -->
        <!-- <a href="{{ url_for('me.me') }}" class="list-group-item list-group-item-action">me</a> -->
        
        <!-- <a href="{{ url_for('item.items') }}" class="list-group-item list-group-item-action">items</a> -->
    <!-- </div>
</div> -->

<!-- Contact Us Section -->
<div id="contact" class="container text-center mt-5">
    <h2>Contact Us</h2>
    <form>
        <div class="mb-3">
            <label for="contactName" class="form-label">Name:</label>
            <input type="text" class="form-control" id="contactName" required>
        </div>
        <div class="mb-3">
            <label for="contactEmail" class="form-label">E-mail:</label>
            <input type="email" class="form-control" id="contactEmail" required>
        </div>
        <div class="mb-3">
            <label for="contactMessage" class="form-label">Message:</label>
            <textarea class="form-control" id="contactMessage" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
</div>

{% endblock %}

{% block footer %}
    <!-- Footer -->
<footer class="bg-light text-center text-lg-start">
    <div class="container p-4">
        <!--Grid row-->
        <div class="row">
            <!--Grid column-->
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Tips & Help</h5>
                <ul class="list-unstyled mb-0">
                    <li><a href="#contact" class="text-dark">About Dreamers Market</a></li>
                    <li><a href="#" class="text-dark">Help</a></li>
                </ul>
            </div>
            <!--Grid column-->

            <!--Grid column-->
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">For Business</h5>
                <ul class="list-unstyled mb-0">
                    <li><a href="#" class="text-dark">Display Ads</a></li>
                </ul>
            </div>
            <!--Grid column-->

            <!--Grid column-->
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Categories</h5>
                 <ul class="list-unstyled mb-0">
                    {% for category in categories %}
                        <li>
                            <a href="{{ url_for('item.items', category=category.id) }}" class="text-dark">
                                {{ category.name }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <!--Grid column-->

            <!--Grid column-->
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Follow Us</h5>
                <a href="https://facebook.com/yourfacebookpage" target="_blank" class="social-icon">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="https://instagram.com/yourinstagramhandle" target="_blank" class="social-icon">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
            <!--Grid column-->
        </div>
        <!--Grid row-->
    </div>

    

    <!-- Copyright -->
    <div class="copy-right text-center">
        Â© 2007-2024 Dreamers Market. All Rights Reserved.
    </div>
</footer>

<!-- Student Information -->
<div class="footer-student mt-3 text-center"> 
    <p>Students Name: Hao Bao & Tao Hu</p> 
    <p>Students ID: 23888818 & 23805764</p> 
    <p>CITS5505 Agile Web Development Project 2</p>
</div>
{% endblock %}<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarDM" aria-controls="navbarDM" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div id="navbarDM" class="collapse navbar-collapse">
    <!-- Logo or branding can go here -->
    <ul class="navbar-nav me-auto">
      <li class="nav-item">
        <a class="nav-link {{ 'active' if  request.path == '/'  else '' }}" aria-current="page" href="/">
          Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ 'active' if request.path | regex_search("^" + url_for('me.me')) else '' }}" href="{{ url_for('me.me') }}">Profile</a>
      </li>
      <!-- Add Explore Market before Log Out -->
      <li class="nav-item">
        <a class="nav-link {{ 'active' if request.path | regex_search("^" + url_for('item.items')) else '' }}" href="{{ url_for('item.items') }}">Explore Market</a>
      </li>
    </ul>

    <div id="navRightContainer">
      <div id="navSearchContainer">
        <input id="navbarSearchInput" name="search_text" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button id="btnNavbarSearch" class="btn btn-outline-success">Search</button>
      </div>
      
      <!-- User profile and dropdown menu -->
      <div class="nav-item dropdown nav-dropdown-container">
        <div class="profile-initials rounded-circle">
          {{ current_user.first_name[0] | upper }}{{ current_user.last_name[-1] | upper }}
        </div>
        <div class="nav-link dropdown-toggle" id="navbarUserDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        </div>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarUserDropdown">
            <a class="dropdown-item {{ 'active' if request.path == url_for('me.me') else '' }}" href="{{ url_for('me.me') }}">My Profile</a>
            <a class="dropdown-item {{ 'active' if request.path | regex_search("^" + url_for('me.saved')) else '' }}" href="{{ url_for('me.saved') }}">Favorites</a>
            <a class="dropdown-item {{ 'active' if request.path | regex_search("^" + url_for('me.items')) else '' }}" href="{{ url_for('me.items') }}">My Listings</a>
            <!-- <a class="dropdown-item" href="/me/bids">My Bids</a> -->
            <hr class="m-1"/>
            <a class="dropdown-item"href="{{ url_for('auth.logout') }}">Log Out</a>
        </div>
      </div>
    </div>
  </div>
</nav>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{% block title %} title {% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- <link rel="stylesheet" href="../static/css/home.css"> -->
    <!-- <link rel="stylesheet" href="../static/css/me.css"> -->
    <script src="http://127.0.0.1:5000/static/js/home/home.js"></script>
    <!-- Material Icons -->
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" /> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Material+Icons"
      rel="stylesheet"> -->
    <script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/js/all.min.js" integrity="sha256-ShtKaqIDL7Iv2AJqPcHXS/s6kjSFvbypN5bRIlKTIk4=" crossorigin="anonymous"></script>

    {% block css_styles %}
      <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
      <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}" />
    {% endblock %}
    
    {% block header_js_scripts %}
      <script >
        const itemsUrl = "{{ url_for('item.items') }}";

        const current_user = {
          id: "{{ current_user.id }}",
          first_name: "{{ current_user.first_name }}",
          last_name: "{{ current_user.last_name }}",
          email: "{{ current_user.email }}",
        }
      </script>
      <script src="{{ url_for('static', filename='js/base.js') }}" defer="defer"></script>
      <script src="{{ url_for('static', filename='js/navbar.js') }}" defer="defer"></script>
    {% endblock %}
  </head>
  <!-- TODO: Update the design of this page if required later -->
  <body>
    {% block navbar %}
      {% include 'navbar.html' %}
    {% endblock %}
    <div class="container mt-0">
      {% block content %}

      {% endblock %}
    </div>

    {% block footer %}
    
    {% endblock %}

    {% import 'macros/toast.html' as toast %}

    <!-- Display flashed messages as toasts in the bottom right corner -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="toast-container position-absolute bottom-0 end-0 p-3">
          {% for category, message in messages %}
            {{ toast.render_toast(type=category, message=message) }}
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Popper JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JavaScript Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <!-- JQuery -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    
    {% block modals %}
      
    {% endblock %}

    <!-- Scripts used by child pages -->
    {% block js_scripts %}
    {% endblock %}
  </body>
</html>
{% extends 'base.html' %}
<!--  -->
{% block title %} Register {% endblock %}
<!--  -->

{% block css_styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/auth/auth.css') }}">
{% endblock %}

{% block navbar %} {% endblock %}
<!--  -->
{% block content %}

<!-- TODO: remove, for testing -->
<div
  class="auth-box"
>
  <form action="" method="post">
    {{ form.csrf_token() }}
    <div class="auth-row">
      {{ form.email.label }} {{ form.email(class="form-control") }} 
    </div>
    <div class="auth-row">
      {{ form.first_name.label }} {{ form.first_name(class="form-control") }}
    </div>
    <div class="auth-row">
      {{ form.last_name.label }} {{ form.last_name(class="form-control") }}
    </div>
    <div class="auth-row">
      {{ form.password.label }} {{ form.password(class="form-control") }}
    </div>
    <div class="auth-row">
      {{ form.confirm_password.label }} {{
      form.confirm_password(class="form-control") }}
    </div>
      {{ form.submit(class="btn btn-primary btn-auth-submit")}}
  </form>

  <!-- TODO: remove, for debugging -->
  {% if form.errors %} {{ form.errors }} {% endif %}
</div>
{% endblock %}
{% extends "base.html" %}
<!--  -->
{% block title %}Login{% endblock %}
<!--  -->

{% block css_styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/auth/auth.css') }}">
{% endblock %}

{% block navbar %} {% endblock %}
<!--  -->
{% block content %}

<!-- TODO: remove, for testing functionality -->
<div
  class="auth-box"
>
  <form method="post">
    {{ form.csrf_token() }}
    <div class="auth-row">
      {{ form.email.label }} {{ form.email(class="form-control") }}
    </div>
    <div class="auth-row">
      {{ form.password.label }} {{ form.password(class="form-control") }}
    </div>
      {{ form.submit(class="btn btn-primary btn-auth-submit") }}
  </form>

  <!-- TODO: remove, for debugging -->
  {% if form.errors %} {{ form.errors }} {% endif %}
</div>
{% endblock %} `
{% macro render_pagination(route_name, pagination, filter) %}

{% set filter_str = filter.filter_to_url_for_string() %}
{% set filter_and = "" if filter_str == "" else "&" %}

<nav class="pb-4 pt-4" aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item">
      <a class="page-link {{ 'disabled' if not pagination.has_prev }}" href="{{ url_for(route_name, page=pagination.prev_num) }}{{ filter_and }}{{ filter_str }}">Previous</a>
    </li>
    {% for page_index in pagination.iter_pages() %}
        {% if page_index %}
            {% if page_index == pagination.page %}
                <li class="page-item">
                    <a class="page-link disabled">
                        {{ page_index }}
                    </a>
                </li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for(route_name, page=page_index) }}{{ filter_and }}{{ filter_str }}">
                        {{ page_index }}
                    </a>
                </li>
            {% endif %}
        {% else %}
            <li class="page-item">
                <a class="page-link disabled">
                    ...
                </a>
            </li>
        {% endif %}
    {% endfor %}
    <li class="page-item">
      <a class="page-link {{ 'disabled' if not pagination.has_next }}" href="{{ url_for(route_name, page=pagination.next_num) }}{{ filter_and }}{{ filter_str }}">Next</a>
    </li>
  </ul>
</nav>
{% endmacro %}{% macro render_toast(type="success", message="") %}
<div class="toast align-items-center fade show {{ type == "success" and "text-bg-success" or "text-bg-danger" }} border-0" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      {{ message }}
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>  
{% endmacro %}{% macro render_item_request_modal(item, disable_button) %}
<div class="modal fade" id="itemRequestModal" tabindex="-1" aria-labelledby="itemRequestModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="itemRequestModalLabel">Request Item</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="item-request-amount" class="col-form-label">Offer Amount</label>
            <input type="number" class="form-control" id="item-request-sender-amount">
          </div>
          <div class="mb-3">
            <label for="item-request-sender-message" class="col-form-label">Message</label>
            <textarea class="form-control" id="item-request-sender-message"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary btn-item-send-request-modal" {{ 'disabled' if disable_button }} data-item-id="{{ item.id }}">
          Send Request
        </button>
      </div>
    </div>
  </div>
</div>
{% endmacro %}

{% macro render_item_request_button(item, disable_button) %}
<button type="button" class="btn btn-primary btn-item-request" {{ 'disabled' if disable_button }} data-item-id="{{ item.id }}" data-bs-toggle="modal" data-bs-target="#itemRequestModal">Request</button>
{% endmacro %}{% macro render_item_card(item, posted_by_user, saved_by_user) %}
    {% set icon_class = 'fa-solid' if saved_by_user else 'fa-regular' %}
    {% set data_item_saved = 'true' if saved_by_user else 'false' %}

    <div class="col-sm-6 col-md-4 mb-3 items-item-card-container">
        <a href="{{ url_for('item.item', item_id=item.id) }}">
            <div class="card item-card">
                <img class="card-img-top item-card-img-top" alt="image" onerror="this.src='/static/img/not-found.webp'" src="{{ item.thumb_photo_url if item.thumb_photo_url else '/static/img/not-found.webp' }}">
                <hr class="border-secondary my-1"/>
                <div class="card-body">
                    <h6 class="card-title">
                        {{ item.title }}
                    </h6>

                    <div class="card-price-container mb-1">
                        <span class="card-text card-text-price">${{ item.price }}</span>
                        <div class="badge badge-used {{ "badge-success" if not item.used else "badge-warning" }}">
                            {{ "New" if not item.used else "Used" }}
                        </div>
                    </div>
                    <p class="card-text card-text-description">
                        {{ item.description }}
                    </p>
                    <p class="card-text font-weight-light">{{ item.city.name }}, {{ item.city.state.name }}</p>
                </div>
                <!-- User can only save item that is posted by some one else -->
            </div>
        </a>
        <div class="card-bottom-container">
            <div class="category-container">
                <span>{{ item.category.name }}</span>
            </div>
            <div class="i-btn-saved-item-container">
                {% if not posted_by_user %}
                    <i class="{{ icon_class }} fa-bookmark i-btn-save-item" data-item-saved="{{ data_item_saved }}" data-item-id="{{ item.id }}"></i>
                {% else %}
                    <p class="card-text">Posted by you</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}<!-- TODO: come up with UI design and replace -->

{% extends 'base.html' %}

{% block title %} Items {% endblock %}

{% block css_styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/item/items.css') }}">
{% endblock %}

{% import 'item/macros/item_card.html' as item_card %}
{% import 'macros/pagination.html' as pagination %}

{% block content %}
    <div class="row">
        <div class="col-sm-12 col-lg-3">
            <!-- Filter & Refine Section -->
            <div id="itemsFilter" class="container text-center my-4 filter-refine">
                <h4 class="mb-4">Filter & Refine</h4>
                <div class="col justify-content-center w-100 text-start">
                    <div class="mb-3">
                        <label for="categorySelect" class="form-label">Category</label>
                        <select id="itemsFilterCategory" class="form-select">
                            <option value="" {{ "selected" if not filter.category else '' }}>All</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" {{ "selected" if category.id == filter.category else "" }}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="locationSelect" class="form-label">Location</label>
                        <select id="itemsFilterCity" class="form-select">
                            <option value="" {{ "selected" if not filter.city else '' }}>All</option>
                            {% for city in cities %}
                                <option value="{{ city.id }}" {{ "selected" if city.id == filter.city else "" }}>
                                    {{ city.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="priceMin" class="form-label">Price Range</label>
                        <input id="itemsFilterMinPrice" type="number" class="form-control" placeholder="$ Min" value="{{ filter.min_price }}">
                        <input id="itemsFilterMaxPrice" type="number" class="form-control mt-2" placeholder="$ Max" value="{{ filter.max_price }}">
                    </div>
                    <button id="btnApplyFilter" class="btn btn-primary mt-2 end-0 w-100" type="button">
                        Apply
                    </button>
                    <button id="btnResetFilter" class="btn btn-primary mt-2 end-0 w-100" type="button">
                        Reset
                    </button>
                </div>
            </div>
                <!-- View More button -->
                <!-- <a href="{{ url_for('item.items') }}" class="btn btn-secondary mt-3">View More</a>
            </div> -->
        </div>
        <div class="col-sm-12 col-lg-9">            
            <div class="row my-4">
                {% for item in items %}         
                    {% set posted_by_user = item.user_id == current_user.id %}
                    {% set saved_by_user = item.saved_by_user %}
                    
                    {{ item_card.render_item_card(item, posted_by_user, saved_by_user) }}
                {% endfor %}
            </div>
        </div>
    </div>

    {{ pagination.render_pagination('item.items', items, filter) }}
{% endblock %}

{% block js_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/item/items.js') }}"></script>
{% endblock %}{% extends 'base.html' %}

{% block title %} New Item {% endblock %}

{% block css_styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/item/item-new.css') }}">
{% endblock %}


{% block content %}

<div class="top-container">
    <h1>Welcome to Dreamers' Market,<br> where your pre-loved items find their new homes. Pass on the value and create joy together!</h1>
</div>


<!-- TODO: Need update, this is here for testing -->
<div id="form-container" class="mb-3">
<form action="" method="post" enctype="multipart/form-data">
    {{ form.csrf_token() }}
    <div class="mb-3">
        {{ form.title.label }}
        {{ form.title(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.city.label }}
        {{ form.city(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.category.label }}
        {{ form.category(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.used.label }}
        {{ form.used(class="form-check") }}
    </div>
    <div class="mb-3">
        {{ form.description.label }}
        {{ form.description(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.price.label }}
        {{ form.price(class="form-control") }}
    </div>
    <!-- TODO: For more interactive file uploads needs javascript involved -->
    <div class="mb-3">
        {{ form.photos.label }}
        {{ form.photos(class="form-control") }}
    </div>

    <!-- TODO: multi photo update over here -->

    <div>{{ form.submit(class="btn btn-success mt-3")}}</div>
</form>
{% endblock %}<!-- TODO: Update this with good UI -->

{% extends 'base.html' %}

{% block title %} {{ item.title }} {% endblock %}

{% import 'item/macros/item-request.html' as item_request %}

{% block css_styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/item/item.css') }}">
{% endblock %}

{% block content %}
<div id="itemCard" class="card mt-4" data-item-id="{{ item.id }}">
    <div class="row">
        <div class="col-sm-12 col-lg-5">
            <div id="carouselExample" class="carousel slide">
                <div class="carousel-inner">
                    {% for photo in item.photos %}
                        <div class="carousel-item {{ 'active' if loop.first }}">
                            <img src="{{ photo.photo_url }}" alt="image" onerror="this.src='/static/img/not-found.webp'">
                        </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                    <i class="fa-solid fa-chevron-left text-black"></i>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                    <i class="fa-solid fa-chevron-right text-black "></i>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="col-sm-12 col-lg-7 bg-light">
            <h5 class="card-title">{{ item.title }}</h5>
            <p class="card-text">{{ item.description }}</p>
            <p class="card-text">$ {{ "%.2f"|format(item.price) }}</p> <!-- Format price assuming item.price is a numeric type -->
            <p class="card-text">Posted: {{ item.create_time.strftime('%Y-%m-%d %H:%M') if item.create_time }}</p> <!-- Format date and time -->
            <p class="card-text">Condition: {{ item.used }}</p>
            <p class="card-text">Category: {{ item.category.name }}</p>
            <p class="card-text">City: {{ item.city.name }}, {{ item.city.state.name }}</p>
            <p class="card-text">Posted by: {{ item.user.first_name + " " + item.user.last_name }}</p>
            {% if current_user.id != item.user.id %}
                {{ item_request.render_item_request_button(item, already_requested) }}
            {% endif %}
        </div>
    </div>
</div>
<div class="comment-container mt-5">
    <h5 class="h5">
        Post a comment
    </h5>
    <div class="comment-box-container">
        <textarea id="commentInput" class="form-control" rows="4" required></textarea>
        <button id="btnPostComment" class="btn btn-primary ml-auto mt-3">
            Post
        </button>
    </div>
    <div class="comment-list-container">
        <h5 class="h5 mb-3">
            Comments
        </h5>
        <div id="commentList">
            {% for comment in comments %}
                <div class="comment" data-comment-id="{{ comment.id }}">
                    <div class="comment-avatar">
                        <span>
                            {{ comment.user.first_name[0] }}
                        </span>
                        <span>
                            {{ comment.user.last_name[0] }}
                        </span>
                    </div>
                    <div class="comment-content">
                        <div>
                            <span class="comment-name">
                                {{ comment.user.first_name + " " + comment.user.last_name }}
                            </span>
                            <span class="comment-time text-secondary">
                                {% if comment.days_ago == 0 %}
                                    Today
                                {% else %}
                                    {% if comment.is_a_month_ago %}
                                        {{ comment.days_ago }}+ days ago
                                    {% else %}
                                        {{ comment.days_ago }} days ago
                                    {% endif %}    
                                {% endif %}                      
                            </span>
                        </div>
                        <p>
                            {{ comment.description }}
                        </p>
                        {% if current_user.id == comment.user.id %}
                            <span class="icon-button-delete" data-action="delete">
                                <i class="fa-solid fa-trash-can"></i>
                            </span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
    {{ super() }}
    {{ item_request.render_item_request_modal(item, already_requested) }}
{% endblock %}

{% block js_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/item/item-request.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item/item.js') }}"></script>
{% endblock %}{% extends 'me/me-base.html' %}

{% set active_page = "me/received-requests" %}

{% import 'macros/pagination.html' as pagination %}
{% import 'me/macros/received-request.html' as macro_received_request %}

{% block title %}
    Received Requests
{% endblock %}

{% block right_content %}
    <div class="gap-3 row">
        {% for request in received_requests %}
            <div class="card received-request-card p-0" data-item-request-id="{{ request.id }}">
                <div class="card-header {{ "bg-primary" if request.accepted is none else "bg-success" if request.accepted else "bg-danger"}}">
                    <a class="link-underline link-underline-opacity-0" href="{{ url_for('item.item', item_id=request.item.id) }}">
                        <h5 class="card-title text-white">{{ request.item.title }}</h5>
                    </a>
                </div>
                <div class="card-body border-bottom">
                    <dl class="row mb-0">
                        <dt class="col-2 mb-2">
                            Sender:
                        </dt>
                        <dd class="col-10">
                            {{ request.sender.first_name + " " + request.sender.last_name }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Offer Amount:
                        </dt>
                        <dd class="col-10">
                            {{ request.offer_amount }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Message:
                        </dt>
                        <dd class="col-10">
                            {{ request.sender_message }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Date:
                        </dt>
                        <dd class="col-10">
                            {{ request.create_time.strftime("%Y-%m-%d %H:%M:%S") }}
                        </dd>
                    </dl>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-2 mb-2">
                            Status:
                        </dt>
                        <dd class="col-10">
                            <span class="{{ "text-primary" if request.accepted is none else "text-success" if request.accepted else "text-danger"}}">
                                {{ "Pending" if request.accepted is none else "Accepted" if request.accepted else "Rejected"}}
                            </span>
                        </dd>
                        {% if request.accepted is not none %}
                            <dt class="col-2 mb-2">
                                Response:
                            </dt>
                            <dd class="col-10">
                                {{ request.receiver_message }}
                            </dd>
                        {% endif %}
                    </dl>
                </div>
                {% if request.accepted is none %}
                    <div class="card-footer text-end">
                        <!-- <button class="btn btn-primary">Respond</button> -->
                        {{ macro_received_request.render_received_request_button(request, False) }}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    {{ pagination.render_pagination('me.saved', received_requests, filter) }}
{% endblock %}

{% block js_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/me/received-request.js') }}"></script>
{% endblock %}

{% block modals %}
    {{ super() }}
    {{ macro_received_request.render_received_request_modal() }}
{% endblock %}
{% extends 'me/me-base.html' %}

{% block title %} Profile {% endblock %}

{% set active_page = "me" %}

{% block right_content %}

    <div class="card border-info">
        <div class="card-body">
            <form action="" method="post" class="p-3">
    {{ form.csrf_token() }}
    <div class="form-group">
        {{ form.email.label(class="form-label") }}
        {{ form.email(class="form-control") }} 
    </div>
    <div class="form-group">
        {{ form.first_name.label(class="form-label") }}
        {{ form.first_name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.last_name.label(class="form-label") }}
        {{ form.last_name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.phone_number.label(class="form-label") }}
        {{ form.phone_number(class="form-control") }}
    </div> 
    <div class="form-group">
        {{ form.address.label(class="form-label") }}
        {{ form.address(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.city.label(class="form-label") }}
        {{ form.city(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.submit(class="btn btn-success")}}
    </div>
</form>

        </div>
    </div>
{% endblock %}{% extends 'me/me-base.html' %}

{% set active_page = "me/bids" %}

{% block title %}
    Bids
{% endblock %}

{% block right_content %}
    bids
{% endblock %}{% extends 'base.html' %}

{% block title %}
    Profile
{% endblock %}

{% block css_styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/me-base.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"> 
{% endblock %}

{% block content %}

    <div class="top-image">
        <img src="{{ url_for('static', filename='img/top-second.jpg') }}" alt="Top Image">
        <div class="image-overlay">
            <h1>Dreamers Market</h1>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-lg-3">
            {% block left_side_nav %}
                <div class="card">
                    <div class="card-header text-center">
                        <a href="/me">
                            <div class="me-profile-initials rounded-circle">
                                {{ current_user.first_name[0] | upper }}{{ current_user.last_name[-1] | upper }}
                            </div>
                        </a>
                    </div>
                    <ul class="list-group me-nav-list">
                        <a class="list-group-item list-group-item-action {{ 'active' if active_page == 'me' else '' }}" href="/me"><i class="bi bi-person-circle"></i>Profile</a>
                        <a class="list-group-item list-group-item-action {{ 'active' if active_page == 'me/saved' else '' }}" href="/me/saved"><i class="bi bi-heart-fill"></i>Favorites</a>
                        <a class="list-group-item list-group-item-action {{ 'active' if active_page == 'me/items' else '' }}" href="/me/items"><i class="bi bi-calendar2-minus"></i>My Listings</a>
                        <!-- <a class="list-group-item list-group-item-action {{ 'active' if active_page == 'me/bids' else '' }}" href="/me/bids"><i class="bi bi-currency-dollar"></i>My Bids</a> -->
                        <a class="list-group-item list-group-item-action text-end {{ 'active' if active_page == 'me/send-requests' else '' }}" href="/me/send-requests">Send Requests</a>
                        <a class="list-group-item list-group-item-action text-end {{ 'active' if active_page == 'me/received-requests' else '' }}" href="/me/received-requests">Received Requests</a>
                    </ul>
                </div>
            {% endblock %}
        </div>
        <div class="col-lg-9">
            <div class="right-content">
                {% block right_content %}
                <!-- Specific content for each page goes here -->
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}

{% block js_scripts %}
    {{ super() }}
{% endblock %}
{% extends 'me/me-base.html' %}

{% set active_page = "me/send-requests" %}

{% import 'macros/pagination.html' as pagination %}

{% block title %}
    Send Requests
{% endblock %}

{% block right_content %}
    <div class="gap-3 row">
        {% for request in send_requests %}
            <div class="card p-0" data-item-request-id="{{ request.id }}">
                <div class="card-header {{ "bg-primary" if request.accepted is none else "bg-success" if request.accepted else "bg-danger"}}">
                    <a class="link-underline link-underline-opacity-0" href="{{ url_for('item.item', item_id=request.item.id) }}">
                        <h5 class="card-title text-white">{{ request.item.title }}</h5>
                    </a>
                </div>
                <div class="card-body border-bottom">
                    <dl class="row mb-0">
                        <dt class="col-2 mb-2">
                            Offer Amount:
                        </dt>
                        <dd class="col-10">
                            {{ request.offer_amount }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Message:
                        </dt>
                        <dd class="col-10">
                            {{ request.sender_message }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Date:
                        </dt>
                        <dd class="col-10">
                            {{ request.create_time.strftime("%Y-%m-%d %H:%M:%S") }}
                        </dd>
                    </dl>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-2 mb-2">
                            Receiver:
                        </dt>
                        <dd class="col-10">
                            {{ request.receiver.first_name + " " + request.receiver.last_name }}
                        </dd>
                        <dt class="col-2 mb-2">
                            Status:
                        </dt>
                        <dd class="col-10">
                            <span class="{{ "text-primary" if request.accepted is none else "text-success" if request.accepted else "text-danger"}}">
                                {{ "Pending" if request.accepted is none else "Accepted" if request.accepted else "Rejected"}}
                            </span>
                        </dd>
                        {% if request.accepted is not none %}
                            <dt class="col-2 mb-2">
                                Response:
                            </dt>
                            <dd class="col-10">
                                {{ request.receiver_message }}
                            </dd>
                        {% endif %}
                    </dl>
                </div>
            </div>
        {% endfor %}
    </div>
    {{ pagination.render_pagination('me.saved', send_requests, filter) }}
{% endblock %}{% macro render_saved_item_card(saved_item) %}
    <div class="card saved-item-card" data-item-id="{{ saved_item.item.id }}">
        <div class="row">
            <div class="col-5">
                <img class="card-img" src="{{ saved_item.item.thumb_photo_url }}" alt="saved image" onerror="this.src='/static/img/not-found.webp'">
            </div>
            <div class="col-7">
                <h5 class="card-title">{{ saved_item.title }}</h5>
                <p class="card-text">{{ saved_item.item.description }}</p>
                <p class="card-text">{{ saved_item.item.price }}</p>
                <p class="card-text">{{ saved_item.item.used }}</p>
                <p class="card-text">{{ saved_item.item.category.name }}</p>
                <p class="card-text">{{ saved_item.item.city.name }}</p>
                <p class="card-text">{{ saved_item.item.city.state.name }}</p>
                <p class="card-text">Posted by {{ saved_item.item.user.first_name + " " + saved_item.item.user.last_name }} at {{ saved_item.item.create_time }}</p>
                <p class="card-text">Saved at {{ saved_item.create_time }}</p>
                <span>
                    <!-- User can only save item that is posted by some one else -->
                    {% if not posted_by_user %}
                        <i class="fa-solid fa-bookmark i-btn-save-item" data-item-id="{{ saved_item.item.id }}" data-action="unSave"></i>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
{% endmacro %}
{% macro render_item_card(item) %}
    <div class="card listing-item-card">
        <div class="row">
            <div class="col-5">
                <img class="card-img listing-card-img" src="{{ item.thumb_photo_url }}" alt="Item Image" onerror="this.src='/static/img/not-found.webp'">
            </div>
            <div class="col-7 listing-item-card-content">
                <h5 class="card-title card-item-title">{{ item.title }}</h5>
                <p class="card-text"><strong>Description:</strong> {{ item.description }}</p>
                <p class="card-text"><strong>Price:</strong> ${{ '%.2f' | format(item.price) }}</p>
                <p class="card-text"><strong>Condition:</strong> {{ 'Used' if item.used else 'New' }}</p>
                <p class="card-text"><strong>Category:</strong> {{ item.category.name }}</p>
                <p class="card-text"><strong>Location:</strong> {{ item.city.name }}, {{ item.city.state.name }}</p>
                <p class="card-text"><strong>Posted on:</strong> {{ item.create_time.strftime('%Y-%m-%d %H:%M') }}</p>
                <div class=item-badge-container>
                    {% if item.sold %}
                        <span class="badge bg-success">Sold Out</span>
                    {% else %}
                        <span class="badge bg-info">Available</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}
{% macro render_received_request_modal() %}
<div class="modal fade modal-lg" id="receivedRequestModal" tabindex="-1" aria-labelledby="receivedRequestModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="receivedRequestModalLabel">Send Response</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="receivedRequestForm">
          <div class="mb-3">
            <label for="message" class="col-form-label">Message</label>
            <textarea class="form-control" id="message"></textarea>
          </div> 
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-cancel" data-bs-dismiss="modal">Close</button>
        <button id="btnRejectRequest" type="button" class="btn btn-danger btn-reject" data-action="reject">
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            <span class="btn-text">Reject</span>
        </button>
        <button id="btnAcceptRequest" type="button" class="btn btn-primary btn-accept" data-action="accept">
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            <span class="btn-text">Accept</span>
        </button>
      </div>
    </div>
  </div>
</div>
{% endmacro %}

{% macro render_received_request_button(item_request, disable_button) %}
<button id="btnOpenReceivedRequestModal" type="button" class="btn btn-primary btn-received-request" {{ 'disabled' if disable_button }} data-item-request-id="{{ item_request.id }}" data-item="{{ item_request.item.id }}" data-bs-toggle="modal" data-bs-target="#receivedRequestModal">
    <span>Respond</span>
</button>
{% endmacro %}{% extends 'me/me-base.html' %}

{% set active_page = "me/saved" %}

{% import 'me/macros/saved-item-card.html' as saved_item_card %}
{% import 'macros/pagination.html' as pagination %}

{% block title %}
    Saved
{% endblock %}

{% block css_styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/me/saved.css') }}">
{% endblock %}

{% block right_content %}
    <!-- æ°å¢æ é¢åä¸æ¡éçº¦æ¨ªçº¿ -->
    <div class="saved-items-header">
        <h1>Saved Items</h1>
        <hr class="subtle-line">
    </div>

    <div class="gap-3 row">
        {% for item in saved_items %}
            <div class="item-container">
                <div class="item-index">{{ loop.index }}.</div>  <!-- Display item number -->
                {{ saved_item_card.render_saved_item_card(item) }}
            </div>
        {% endfor %}
    </div>
    {{ pagination.render_pagination('me.saved', saved_items, filter) }}
{% endblock %}

{% block js_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/me/saved.js') }}"></script>
{% endblock %}
{% extends 'me/me-base.html' %}

{% set active_page = "me/items" %}

{% block title %}
    Items
{% endblock %}

{% import 'me/macros/item-card.html' as item_card %}
{% import 'macros/pagination.html' as pagination %}

{% block right_content %}
    <div class="gap-3 row">
        {% for item in items %}
            <div>
                {{ item_card.render_item_card(item) }}
            </div>
        {% endfor %}
    </div>
    {{ pagination.render_pagination('me.items', items, filter) }}
{% endblock %}
